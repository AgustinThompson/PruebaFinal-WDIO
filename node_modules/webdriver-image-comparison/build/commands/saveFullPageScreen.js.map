{"version":3,"file":"saveFullPageScreen.js","sourceRoot":"","sources":["../../lib/commands/saveFullPageScreen.ts"],"names":[],"mappings":"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","sourcesContent":["import beforeScreenshot from '../helpers/beforeScreenshot';\nimport afterScreenshot from '../helpers/afterScreenshot';\nimport { getBase64FullPageScreenshotsData } from '../methods/screenshots';\nimport { makeFullPageBase64Image } from '../methods/images';\nimport { ScreenshotOutput } from '../helpers/afterScreenshot.interfaces';\nimport { Methods } from '../methods/methods.interface';\nimport { InstanceData } from '../methods/instanceData.interfaces';\nimport { Folders } from '../base.interface';\nimport { SaveFullPageOptions } from './fullPage.interfaces';\nimport { BeforeScreenshotOptions, BeforeScreenshotResult } from '../helpers/beforeScreenshot.interface';\nimport { FullPageScreenshotDataOptions, FullPageScreenshotsData } from '../methods/screenshots.interfaces';\n\n/**\n * Saves an image of the full page\n */\nexport default async function saveFullPageScreen(\n  methods: Methods,\n  instanceData: InstanceData,\n  folders: Folders,\n  tag: string,\n  saveFullPageOptions: SaveFullPageOptions,\n): Promise<ScreenshotOutput> {\n  // 1a. Set some variables\n  const {\n    addressBarShadowPadding,\n    autoSaveBaseline,\n    formatImageName,\n    isHybridApp,\n    logLevel,\n    savePerInstance,\n    toolBarShadowPadding,\n  } = saveFullPageOptions.wic;\n\n  // 1b. Set the method options to the right values\n  const disableCSSAnimation: boolean =\n    'disableCSSAnimation' in saveFullPageOptions.method\n      ? saveFullPageOptions.method.disableCSSAnimation\n      : saveFullPageOptions.wic.disableCSSAnimation;\n  const hideScrollBars: boolean =\n    'hideScrollBars' in saveFullPageOptions.method\n      ? saveFullPageOptions.method.hideScrollBars\n      : saveFullPageOptions.wic.hideScrollBars;\n  const fullPageScrollTimeout: number =\n    'fullPageScrollTimeout' in saveFullPageOptions.method\n      ? saveFullPageOptions.method.fullPageScrollTimeout\n      : saveFullPageOptions.wic.fullPageScrollTimeout;\n  const hideElements: HTMLElement[] = saveFullPageOptions.method.hideElements || [];\n  const removeElements: HTMLElement[] = saveFullPageOptions.method.removeElements || [];\n  const hideAfterFirstScroll: HTMLElement[] = saveFullPageOptions.method.hideAfterFirstScroll || [];\n\n  // 2.  Prepare the beforeScreenshot\n  const beforeOptions: BeforeScreenshotOptions = {\n    instanceData,\n    addressBarShadowPadding,\n    disableCSSAnimation,\n    hideElements,\n    logLevel,\n    noScrollBars: hideScrollBars,\n    removeElements,\n    toolBarShadowPadding,\n  };\n  const enrichedInstanceData: BeforeScreenshotResult = await beforeScreenshot(methods.executor, beforeOptions, true);\n  const devicePixelRatio = enrichedInstanceData.dimensions.window.devicePixelRatio;\n  const isLandscape = enrichedInstanceData.dimensions.window.isLandscape;\n\n  // 3.  Fullpage screenshots are taken per scrolled viewport\n  const fullPageScreenshotOptions: FullPageScreenshotDataOptions = {\n    addressBarShadowPadding: enrichedInstanceData.addressBarShadowPadding,\n    devicePixelRatio,\n    fullPageScrollTimeout,\n    hideAfterFirstScroll,\n    innerHeight: enrichedInstanceData.dimensions.window.innerHeight,\n    isAndroid: enrichedInstanceData.isAndroid,\n    isAndroidChromeDriverScreenshot: enrichedInstanceData.isAndroidChromeDriverScreenshot,\n    isAndroidNativeWebScreenshot: enrichedInstanceData.isAndroidNativeWebScreenshot,\n    isHybridApp,\n    isIos: enrichedInstanceData.isIos,\n    isLandscape,\n    logLevel: logLevel,\n    screenHeight: enrichedInstanceData.dimensions.window.screenHeight,\n    screenWidth: enrichedInstanceData.dimensions.window.screenWidth,\n    toolBarShadowPadding: enrichedInstanceData.toolBarShadowPadding,\n  };\n  const screenshotsData: FullPageScreenshotsData = await getBase64FullPageScreenshotsData(\n    methods.screenShot,\n    methods.executor,\n    fullPageScreenshotOptions,\n  );\n\n  // 4.  Make a fullpage base64 image\n  const fullPageBase64Image: string = await makeFullPageBase64Image(screenshotsData, {\n    devicePixelRatio,\n    isLandscape,\n  });\n\n  // 5.  The after the screenshot methods\n  const afterOptions = {\n    actualFolder: folders.actualFolder,\n    base64Image: fullPageBase64Image,\n    disableCSSAnimation,\n    filePath: {\n      autoSaveBaseline,\n      browserName: enrichedInstanceData.browserName,\n      deviceName: enrichedInstanceData.deviceName,\n      isMobile: enrichedInstanceData.isMobile,\n      savePerInstance,\n    },\n    fileName: {\n      browserName: enrichedInstanceData.browserName,\n      browserVersion: enrichedInstanceData.browserVersion,\n      deviceName: enrichedInstanceData.deviceName,\n      devicePixelRatio: enrichedInstanceData.dimensions.window.devicePixelRatio,\n      formatImageName,\n      isMobile: enrichedInstanceData.isMobile,\n      isTestInBrowser: enrichedInstanceData.isTestInBrowser,\n      logName: enrichedInstanceData.logName,\n      name: enrichedInstanceData.name,\n      outerHeight: enrichedInstanceData.dimensions.window.outerHeight,\n      outerWidth: enrichedInstanceData.dimensions.window.outerWidth,\n      platformName: enrichedInstanceData.platformName,\n      platformVersion: enrichedInstanceData.platformVersion,\n      screenHeight: enrichedInstanceData.dimensions.window.screenHeight,\n      screenWidth: enrichedInstanceData.dimensions.window.screenWidth,\n      tag,\n    },\n    hideElements,\n    hideScrollBars,\n    isLandscape,\n    logLevel,\n    platformName: instanceData.platformName,\n    removeElements,\n  };\n\n  // 6.  Return the data\n  return afterScreenshot(methods.executor, afterOptions);\n}\n"]}